<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Use correct character set. -->
    <meta charset="utf-8" />
    <!-- Tell IE to use the latest, best version. -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <title>Hello World!</title>
    <script src="../Build/Cesium/Cesium.js"></script>
    <style>
      @import url(../Build/Cesium/Widgets/widgets.css);
      html,
      body,
      #cesiumContainer {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      
      #contextmenu {
        display:none;
        position:fixed;
        left:0px;
        top:0px;
        widows: 150px;
        height:100px;
        background-color:#f0f0f0;
        border:1px solid #eee;
      }

      #contextmenu.show {
        display: block;
      }
    </style>
  </head>
  <body>
    <div id="cesiumContainer"></div>
    <div id="contextmenu" class="contextmenu"> 
        <li onclick="menu1()">menu1</li>
        <li onclick="menu2()">menu2</li>
    </div>

    <script>
      var czml = [
                  {
                    id: "document",
                    version: "1.0"
                  },
                  {
                    id: "Vehicle2",
                    description : "This is a missile",
                    availability: "2012-08-04T16:01:00Z/2012-08-04T16:02:00Z",
                    model:{
                      gltf:"https://cesium.com/public/SandcastleSampleData/launchvehicle.glb"
                    },
                    orientation:{
                      velocityReference: "#position"
                    },
                    position:{
                      epoch:"2012-08-04T16:01:00Z",
                      cartographicDegrees:[
                        0,
                        130.36212,
                        33.59531,
                        90.0,
                        1,
                        130.35147,
                        33.59329,
                        160.0,
                      ],
                    }
                  }
                ]
      var viewer = new Cesium.Viewer("cesiumContainer");
//       const buildingTileset = viewer.scene.primitives.add(Cesium.createOsmBuildings());
//       viewer.dataSources.add(Cesium.CzmlDataSource.load(czml));
//       viewer.dataSources.add(Cesium.CzmlDataSource.load("./SampleData/Vehicle.czml"));
//       viewer.dataSources.add(Cesium.GeoJsonDataSource.load("./SampleData/abe.geojson"));
//       viewer.dataSources.add(Cesium.GeoJsonDataSource.load("./SampleData/abe.czml"));
      
      // 長押しか右クリックかの判定
      let mousedown_time = 0;
      // マウスボタン押下
      viewer.canvas.addEventListener("pointerdown", function(e) {
        // 右クリック時
        if(event.which == 3){
          mousedown_time = performance.now();
        }
      }, false);    
      
      let con = document.getElementById('contextmenu'); 
      var longitudeString = 0;
      var latitudeString = 0;
      
      viewer.canvas.addEventListener('contextmenu', function(e){ // right click
        const difftime = performance.now() - mousedown_time;
        if(difftime <= 1000) {
          var mousePosition = new Cesium.Cartesian2(e.clientX, e.clientY);
//           var mousePosition = new Cesium.Cartesian3(e.clientX, e.clientY, e.clientZ);

          var ellipsoid = viewer.scene.globe.ellipsoid; // Gets an ellipsoid describing the shape of this globe.
          var cartesian = viewer.camera.pickEllipsoid(mousePosition, ellipsoid);
          if (cartesian) {
              var cartographic = ellipsoid.cartesianToCartographic(cartesian);
              longitudeString = Cesium.Math.toDegrees(cartographic.longitude).toFixed(2);
              latitudeString = Cesium.Math.toDegrees(cartographic.latitude).toFixed(2);

//               alert(longitudeString + ', ' + latitudeString); 
              con.style.left = e.pageX + 'px';
              con.style.top = e.pageY + 'px';
              con.classList.add('show');
          } else {
              alert('Globe was not picked');
          }
        }
      }, false);
      
      viewer.canvas.addEventListener('click', function(e){ // left click
        con.classList.remove('show');
      }, false);
      
      function menu1(){
        alert(longitudeString + ', ' + latitudeString); 
        con.classList.remove('show');
      }
      function menu2(){
        alert('メニュー2押した');
        con.classList.remove('show');
      }

//       var entities = viewer.entities;
//       var boxes = entities.add(new Cesium.Entity());
//       entities.add({
//       parent : boxes,
//       name : 'sample',
//         rectangle : {
//           material : './SampleData/cesium_stripes.png'
//       }
//       });

//       const viewer = new Cesium.Viewer('cesiumContainer', {
//         imageryProvider: new Cesium.UrlTemplateImageryProvider({
//           url : 'https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg',
//           credit : new Cesium.Credit('<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>', true)
//         })
//       });
//       //const buildingTileset = viewer.scene.primitives.add(Cesium.createOsmBuildings());
//       document.getElementsByTagName('canvas')[0].addEventListener('contextmenu',function (e){
//         console.log(e)
//       });
    </script>
  </body>
</html>
